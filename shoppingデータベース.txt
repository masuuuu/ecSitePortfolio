create database shop_db default character set utf8;

grant all privileges on shop_db.* to shop_user@'localhost' identified by 'shop_pass' with grant option;

use shop_db;
state 0 デフォルト
state 1 削除,済

//商品テーブル
create table items(
  item_id int unsigned not null auto_increment,
  item_name varchar(100) not null,
  detail text not null,
  price decimal(10,3) unsigned not null,
  category_id tinyint unsigned not null,
  regist_date datetime not null,
  update_date datetime,
  delete_date datetime,
  state tinyint(1) unsigned not null default 0,
  primary key(item_id)
);

//SKU
create table skus(
  sku_id int unsigned not null auto_increment,
  sku_code varchar(255) not null,
  item_id int unsigned not null,
  color varchar(10) not null,
  size varchar(10) not null,
  quantity int unsigned not null default 0,
  regist_date datetime not null,
  delete_date datetime,
  state tinyint(1) unsigned not null default 0,
  primary key(sku_id),
  index sku_idx(sku_code)
);

//image
create table images(
  image_id int unsigned not null auto_increment,
  item_id int unsigned not null,
  item_image_id char(4) unsigned not null,
  image varchar(255),
  regist_date datetime not null,
  update_date datetime,
  delete_date datetime,
  state tinyint(1) unsigned not null default 0,
  primary key(image_id)
);

//デシマル:decimal(最大桁数,小数点以下の桁数)
//インデックス:データの検索速度を向上させるために、どの行がどこにあるかを示した索引のこと

//カート（取引）
create table carts(
  crt_id int unsigned not null auto_increment,
  user_id int unsigned not null,
  item_id int unsigned not null,
  item_sku varchar(255) not null,
  quantity tinyint(1) unsigned not null default 1,
  state tinyint(1) unsigned not null default 0,
  primary key(crt_id),
  index crt_idx(users_id, state)
);

//アイテムカテゴリー
create table categorys(
  category_id tinyint unsigned not null auto_increment,
  category_name varchar(100) not null,
  primary key(category_id)
);

1 OUTER
2 TOPS
3 BOTTOMS
4 DRESS
5 SHOES
6 BAG

insert into category values (1, 'OUTER'), (2, 'TOPS'), (3, 'BOTTOMS'), (4, 'DRESS'), (5, 'SHOES'), (6, 'BAG');



//顧客の認識
create table session(
  user_id int unsigned not null auto_increment,
  session_key varchar(32),
  primary key(users_id)
);


//ユーザー会員登録
create table users(
  user_id int unsigned not null auto_increment,
  full_name varchar(32) not null,
  full_name_kana varchar(32) not null,
  sex tinyint(1) unsigned not null,
  year varchar(4) not null,
  month varchar(2) not null,
  day varchar(2) not null,
  zip1 varchar(3) not null,
  zip2 varchar(4) not null,
  address varchar(100) not null,
  email varchar(255) not null,
  phone_number varchar(11) not null,
  password varchar(255) not null,
  regist_date datetime not null,
  update_date datetime,
  delete_date datetime,
  state tinyint(1) unsigned not null default 0,
  primary key(users_id)
);

//スタッフ登録
create table staffs(
  staff_id int unsigned not null auto_increment,
  staff_name varchar(32) not null,
  pass varchar(255) not null,
  regist_date datetime not null,
  update_date datetime,
  delete_date datetime,
  state tinyint(1) unsigned not null default 0,
  primary key(staff_id)
);

passは8～16文字の半角英数字ハッシュ化
state 状態 0デフォルト 1削除


http://www.post.japanpost.jp/zipcode/dl/kogaki.html
の全国一括をダウンロード utf8に変更

create table postcode(
  jis varchar(5),
  old_zip varchar(5),
  zip varchar(7),
  pref_kana varchar(100),
  city_kana varchar(100),
  town_kana varchar(100),
  pref varchar(100),
  city varchar(100),
  town varchar(100),
  comment1 tinyint(1) unsigned,
  comment2 tinyint(1) unsigned,
  comment3 tinyint(1) unsigned,
  comment4 tinyint(1) unsigned,
  comment5 tinyint(1) unsigned,
  comment6 tinyint(1) unsigned
);

LOAD DATA INFILE 'c:/xampp/htdocs/shop/KEN_ALL.CSV' INTO TABLE `postcode` FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"';


//お問い合わせ
create table contacts(
  contact_id int unsigned not null auto_increment,
  full_name varchar(32) not null,
  email varchar(255) not null,
  contact_content varchar(255) not null,
  regist_date datetime not null,
  delete_date datetime,
  state tinyint(1) unsigned not null default 0,
  primary key(contact_id)
);

//パスワード再設定
create table password_resets(
  email varchar(255) PRIMARY KEY,
  token varchar(80) NOT NULL,
  token_sent_at DATETIME
);

お支払い方法
create table payments(
  payment_id int unsigned not null primary key auto_increment,
  payment_name varchar(100) not null,
  payment_fee decimal(10,3) unsigned not null
);

1 クレジットカード
2 代引き


//注文
create table orders(
  order_no varchar(19) not null primary key,
  user_id int unsigned not null,
  payment_id int unsigned not null,
  total_price decimal(10,3) unsigned not null,
  order_date datetime,
  delete_date datetime,
  state tinyint(1) unsigned not null default 0,
  index user_id_idx(user_id)
);

注文詳細
create table order_details(
  order_detail_id int unsigned not null primary key auto_increment,
  order_no varchar(19) not null,
  sku_code varchar(255) not null,
  quantity tinyint(1) unsigned not null,
  price decimal(10,3) unsigned not null,
  delete_date datetime,
  state tinyint(1) unsigned not null default 0,
  index order_no_idx(order_no)
);